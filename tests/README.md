# راهنمای تست‌های سیستم فروشگاهی

این مجموعه تست‌ها برای اطمینان از عملکرد صحیح تمامی بخش‌های اصلی سیستم فروشگاهی طراحی شده است.

## ساختار تست‌ها

### 1. تست‌های مدیریت محصولات (`ProductManagementTest.php`)
- ایجاد محصول جدید
- ویرایش اطلاعات محصول
- مدیریت تخفیف‌ها
- مدیریت ویژگی‌های محصول
- آپلود و مدیریت تصاویر
- اعتبارسنجی داده‌ها
- جستجو و فیلتر محصولات
- مدیریت موجودی
- کنترل دسترسی

### 2. تست‌های مدیریت دسته‌بندی‌ها (`CategoryManagementTest.php`)
- ایجاد دسته‌بندی جدید
- ویرایش دسته‌بندی‌ها
- مدیریت سلسله مراتب (والد-فرزند)
- حذف دسته‌بندی‌ها
- اعتبارسنجی یکتایی
- جستجو و فیلتر
- کنترل دسترسی

### 3. تست‌های مدیریت کوپن‌ها (`CouponManagementTest.php`)
- ایجاد کوپن درصدی و مبلغ ثابت
- ویرایش کوپن‌ها
- اعتبارسنجی کوپن‌ها
- محاسبه تخفیف
- مدیریت تاریخ انقضا
- کنترل حد استفاده
- جستجو و فیلتر
- کنترل دسترسی

### 4. تست‌های مدیریت نظرات (`ReviewManagementTest.php`)
- مشاهده نظرات
- تایید و رد نظرات
- پاسخ به نظرات
- حذف نظرات
- جستجو در نظرات
- فیلتر بر اساس وضعیت و امتیاز
- آمار نظرات
- کنترل دسترسی

### 5. تست‌های عملیات سیستم (`SystemOperationsTest.php`)
- احراز هویت کاربران
- مدیریت سفارشات
- مدیریت سبد خرید
- اعمال کوپن‌ها
- مدیریت آدرس‌های کاربران
- پردازش پرداخت‌ها
- مدیریت موجودی
- امنیت سیستم
- یکپارچگی داده‌ها

## نحوه اجرای تست‌ها

### اجرای تمام تست‌ها
```bash
php artisan test
```

### اجرای تست‌های خاص

#### تست‌های مدیریت محصولات
```bash
php artisan test --testsuite=ProductManagement
```

#### تست‌های مدیریت دسته‌بندی‌ها
```bash
php artisan test --testsuite=CategoryManagement
```

#### تست‌های مدیریت کوپن‌ها
```bash
php artisan test --testsuite=CouponManagement
```

#### تست‌های مدیریت نظرات
```bash
php artisan test --testsuite=ReviewManagement
```

#### تست‌های عملیات سیستم
```bash
php artisan test --testsuite=SystemOperations
```

### اجرای تست خاص
```bash
php artisan test --filter=test_method_name
```

### اجرای تست‌ها با گزارش پوشش کد
```bash
php artisan test --coverage
```

## پیش‌نیازها

### تنظیمات محیط تست
1. فایل `.env.testing` را ایجاد کنید
2. دیتابیس جداگانه برای تست تنظیم کنید
3. کلیدهای API مورد نیاز را تنظیم کنید

### نمونه فایل `.env.testing`
```env
APP_ENV=testing
DB_CONNECTION=sqlite
DB_DATABASE=:memory:
CACHE_DRIVER=array
SESSION_DRIVER=array
QUEUE_CONNECTION=sync
```

## ویژگی‌های تست‌ها

### استفاده از Factory ها
تمام تست‌ها از Factory های Laravel برای ایجاد داده‌های تست استفاده می‌کنند:
- `UserFactory`
- `ProductFactory`
- `CategoryFactory`
- `CouponFactory`
- `ReviewFactory`
- `OrderFactory`
- `PaymentFactory`
- `UserAddressFactory`

### RefreshDatabase
تمام تست‌ها از trait `RefreshDatabase` استفاده می‌کنند تا دیتابیس بین هر تست پاک شود.

### Livewire Testing
تست‌های کامپوننت‌های Livewire با استفاده از `Livewire::test()` انجام می‌شوند.

## انواع تست‌ها

### تست‌های عملکردی (Functional Tests)
- تست کامل فرآیندهای کاری
- تست تعامل بین کامپوننت‌ها
- تست رابط کاربری

### تست‌های اعتبارسنجی (Validation Tests)
- تست قوانین اعتبارسنجی
- تست پیام‌های خطا
- تست داده‌های نامعتبر

### تست‌های امنیتی (Security Tests)
- تست کنترل دسترسی
- تست احراز هویت
- تست مجوزها

### تست‌های مرزی (Edge Case Tests)
- تست حالات استثنایی
- تست محدودیت‌ها
- تست خطاها

## گزارش‌گیری

### اجرای تست‌ها با خروجی مفصل
```bash
php artisan test --verbose
```

### ذخیره نتایج تست
```bash
php artisan test --log-junit results.xml
```

### تولید گزارش HTML
```bash
php artisan test --coverage-html coverage
```

## نکات مهم

1. **محیط تست جداگانه**: همیشه از دیتابیس و محیط جداگانه برای تست استفاده کنید
2. **پاک‌سازی داده‌ها**: تست‌ها نباید بر یکدیگر تأثیر بگذارند
3. **داده‌های واقعی**: از Factory ها برای تولید داده‌های تست استفاده کنید
4. **تست کامل**: تمام مسیرهای ممکن را تست کنید
5. **عملکرد**: تست‌ها باید سریع اجرا شوند

## عیب‌یابی

### مشکلات رایج

#### خطای دیتابیس
```bash
php artisan migrate:fresh --env=testing
```

#### خطای Cache
```bash
php artisan config:clear
php artisan cache:clear
```

#### خطای Livewire
```bash
php artisan view:clear
```

## مشارکت در تست‌ها

### اضافه کردن تست جدید
1. تست را در فایل مناسب اضافه کنید
2. از نام‌گذاری مناسب استفاده کنید
3. کامنت مناسب اضافه کنید
4. تست را اجرا کنید

### بهترین روش‌ها
- هر تست باید یک مسئولیت داشته باشد
- نام تست باید واضح و توصیفی باشد
- از assertion های مناسب استفاده کنید
- تست‌ها باید قابل تکرار باشند

این مجموعه تست‌ها اطمینان می‌دهد که سیستم فروشگاهی شما به درستی کار می‌کند و تغییرات آینده مشکلی ایجاد نمی‌کنند.